<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register | Persona Fest 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Apple-style liquid glass background -->
    <div class="liquid-bg">
        <div class="liquid-shape liquid-shape-1"></div>
        <div class="liquid-shape liquid-shape-2"></div>
    </div>
    
    <!-- Apple-style navbar -->
    <nav class="navbar"> 
        <div class="navbar__container">
            <a href="index.html" id="navbar__logo">MIT Art, Design & Technology University</a>
            <ul class="navbar__menu">
                <li class="navbar__item"><a href="index.html" class="navbar__links">Home</a></li>
                <li class="navbar__item"><a href="tech.html" class="navbar__links">Events</a></li>
                <li class="navbar__item"><a href="index.html#about" class="navbar__links">About</a></li>
                <li class="navbar__item"><button id="loginBtn" class="navbar__links" style="background:none; border:none; cursor:pointer;">Log In</button></li>
            </ul>
        </div>
    </nav>
    
    <!-- Registration form section -->
    <section class="section-wrapper">
        <div class="section-title">
            <h2>Event Registration</h2>
            <p>Join inter-college competitions and showcase your talents</p>
        </div>
        
        <form id="eventRegistrationForm" style="max-width: 600px; margin: 0 auto;">
            <!-- Personal Information -->
            <div class="form-section">
                <h3>Personal Information</h3>
                <div class="input-group">
                    <i class="fas fa-user"></i>
                    <input type="text" id="name" name="name" placeholder="Full Name" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-envelope"></i>
                    <input type="email" id="email" name="email" placeholder="Email" required>
                </div>
                <div class="input-group">
                    <i class="fas fa-phone"></i>
                    <input type="tel" id="phone" name="phone" placeholder="Phone Number" required>
                </div>
            </div>

            <!-- Event Selection -->
            <div class="form-section">
                <h3>Event Selection</h3>
                <div id="selectionStatus" style="margin-bottom: 15px; color: var(--apple-blue); font-size: 14px;"></div>
                
                <!-- Custom Event Category Dropdown -->
                <div class="custom-select-wrapper">
                    <div class="custom-select">
                        <i class="fas fa-list custom-select__icon"></i>
                        <div class="custom-select__trigger"><span>Select Category</span>
                            <div class="custom-select__arrow"></div>
                        </div>
                        <div class="custom-options">
                            <span class="custom-option" data-value="design">Design Contest</span>
                            <span class="custom-option" data-value="hackathon">Hackathon</span>
                            <span class="custom-option" data-value="esports-mobile">ESports - Mobile</span>
                            <span class="custom-option" data-value="esports-pc">ESports - PC</span>
                        </div>
                    </div>
                    <input type="hidden" id="eventCategory" name="eventCategory" required>
                </div>
                
                <!-- Design Events -->
                <div id="designEvents" class="event-options" style="display: none;">
                    <div class="custom-select-wrapper">
                        <div class="custom-select">
                            <i class="fas fa-paint-brush custom-select__icon"></i>
                            <div class="custom-select__trigger"><span>Select Design Event</span>
                                <div class="custom-select__arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" data-value="UX/UI Design">UX/UI Design</span>
                                <span class="custom-option" data-value="Graphic Design">Graphic Design</span>
                                <span class="custom-option" data-value="3D Modeling">3D Modeling</span>
                                <span class="custom-option" data-value="Digital Art">Digital Art</span>
                            </div>
                        </div>
                        <input type="hidden" id="designEvent" name="designEvent">
                    </div>
                </div>
                
                <!-- Hackathon Events -->
                <div id="hackathonEvents" class="event-options" style="display: none;">
                    <div class="custom-select-wrapper">
                        <div class="custom-select">
                            <i class="fas fa-code custom-select__icon"></i>
                            <div class="custom-select__trigger"><span>Select Hackathon Type</span>
                                <div class="custom-select__arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" data-value="Web Development">Web Development</span>
                                <span class="custom-option" data-value="Mobile App">Mobile App</span>
                                <span class="custom-option" data-value="AI/ML">AI/ML</span>
                                <span class="custom-option" data-value="Open Innovation">Open Innovation</span>
                            </div>
                        </div>
                        <input type="hidden" id="hackathonEvent" name="hackathonEvent">
                    </div>
                </div>
                
                <!-- Mobile Games Events -->
                <div id="mobileGamesEvents" class="event-options" style="display: none;">
                    <div class="custom-select-wrapper">
                        <div class="custom-select">
                            <i class="fas fa-mobile-alt custom-select__icon"></i>
                            <div class="custom-select__trigger"><span>Select Mobile Game</span>
                                <div class="custom-select__arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" data-value="BGMI">BGMI</span>
                                <span class="custom-option" data-value="Free Fire">Free Fire</span>
                                <span class="custom-option" data-value="CODM">CODM</span>
                            </div>
                        </div>
                        <input type="hidden" id="mobileGameEvent" name="mobileGameEvent">
                    </div>
                </div>
                
                <!-- PC Games Events -->
                <div id="pcGamesEvents" class="event-options" style="display: none;">
                    <div class="custom-select-wrapper">
                        <div class="custom-select">
                            <i class="fas fa-gamepad custom-select__icon"></i>
                            <div class="custom-select__trigger"><span>Select PC Game</span>
                                <div class="custom-select__arrow"></div>
                            </div>
                            <div class="custom-options">
                                <span class="custom-option" data-value="Valorant">Valorant</span>
                                <span class="custom-option" data-value="CS2">CS2</span>
                                <span class="custom-option" data-value="Dota 2">Dota 2</span>
                                <span class="custom-option" data-value="Warzone">Warzone</span>
                                <span class="custom-option" data-value="BO6 Multiplayer">BO6 Multiplayer</span>
                                <span class="custom-option" data-value="League of Legends">League of Legends</span>
                            </div>
                        </div>
                        <input type="hidden" id="pcGameEvent" name="pcGameEvent">
                    </div>
                </div>
            </div>

            <!-- Team Information -->
            <div class="form-section" id="teamSection" style="display: none;">
                <h3>Team Information</h3>
                <div class="input-group">
                    <i class="fas fa-users"></i>
                    <input type="text" id="teamName" name="teamName" placeholder="Team Name">
                </div>
                
                <div id="teamMembers">
                    <!-- Team members will be dynamically added here -->
                    <div class="input-group">
                        <i class="fas fa-user-plus"></i>
                        <input type="text" name="teamMember1" placeholder="Team Captain (You)" disabled>
                    </div>
                </div>
                
                <div class="team-size-controls">
                    <p>Team Size: <span id="teamSizeDisplay">1</span></p>
                    <button type="button" id="addTeamMember" class="small-button">
                        <i class="fas fa-plus"></i> Add Member
                    </button>
                </div>
            </div>

            <button type="submit" class="modal-button">
                <span>Register for Event</span>
                <i class="fas fa-arrow-right"></i>
            </button>
            
            <div id="registrationMsg" style="margin-top:16px; text-align:center;"></div>
        </form>
    </section>
    
    <!-- Apple-style footer -->
    <footer style="text-align: center; padding: 40px 20px; color: var(--apple-mid-gray); font-size: 12px;">
        <p>Copyright © 2025 MIT Art, Design & Technology University. All rights reserved.</p>
    </footer>
    
    <!-- Apple-style liquid cursor -->
    <div class="liquid-cursor"></div>
    <div class="liquid-cursor-follower"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="liquid-glass.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Custom Select Initialization
        document.querySelectorAll('.custom-select-wrapper').forEach(function(wrapper) {
            const select = wrapper.querySelector('.custom-select');
            const trigger = wrapper.querySelector('.custom-select__trigger');
            const options = wrapper.querySelectorAll('.custom-option');
            const hiddenInput = wrapper.querySelector('input[type="hidden"]');
            
            // Toggle select open/close
            trigger.addEventListener('click', function() {
                select.classList.toggle('open');
            });
            
            // Close when clicking outside
            window.addEventListener('click', function(e) {
                if (!select.contains(e.target)) {
                    select.classList.remove('open');
                }
            });
            
            // Option selection
            options.forEach(function(option) {
                option.addEventListener('click', function() {
                    // Update trigger text
                    trigger.querySelector('span').textContent = this.textContent;
                    
                    // Mark as selected
                    options.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    // Update hidden input value
                    if (hiddenInput) {
                        hiddenInput.value = this.dataset.value;
                        
                        // Trigger change event on the hidden input
                        const event = new Event('change', { bubbles: true });
                        hiddenInput.dispatchEvent(event);
                    }
                    
                    // Close dropdown
                    select.classList.remove('open');
                });
            });
        });
        
        // Variables for event handling
        const eventCategory = document.getElementById('eventCategory');
        const designEvents = document.getElementById('designEvents');
        const hackathonEvents = document.getElementById('hackathonEvents');
        const mobileGamesEvents = document.getElementById('mobileGamesEvents');
        const pcGamesEvents = document.getElementById('pcGamesEvents');
        const teamSection = document.getElementById('teamSection');
        const addTeamMember = document.getElementById('addTeamMember');
        const teamMembers = document.getElementById('teamMembers');
        const teamSizeDisplay = document.getElementById('teamSizeDisplay');
        const registrationForm = document.getElementById('eventRegistrationForm');
        const registrationMsg = document.getElementById('registrationMsg');
        
        let teamSize = 1;
        let maxTeamSize = 5; // Default max team size
        
        // Enhanced event category selection handler
        eventCategory.addEventListener('change', function(e) {
            console.log("Category selected:", this.value);
            
            // Find all custom selects for visual feedback
            const allCategoryOptions = document.querySelectorAll('.custom-option');
            allCategoryOptions.forEach(opt => {
                if (opt.dataset.value === this.value) {
                    opt.classList.add('active-category');
                } else {
                    opt.classList.remove('active-category');
                }
            });
            
            // Hide all event options with fade-out effect
            hideAllEventOptions();
            
            // Reset team members
            resetTeamMembers();
            
            // Clear any previous selection message
            document.getElementById('selectionStatus').textContent = '';
            
            // Handle the selected category
            const selectedValue = this.value;
            if (selectedValue) {
                // Show loading indicator
                document.getElementById('selectionStatus').textContent = `Loading ${selectedValue} options...`;
                
                setTimeout(() => {
                    switch(selectedValue) {
                        case 'design':
                            showEventOption(designEvents);
                            document.getElementById('designEvent').required = true;
                            document.getElementById('selectionStatus').textContent = '';
                            break;
                            
                        case 'hackathon':
                            showEventOption(hackathonEvents);
                            showEventOption(teamSection);
                            document.getElementById('hackathonEvent').required = true;
                            maxTeamSize = 4;
                            document.getElementById('selectionStatus').textContent = '';
                            break;
                            
                        case 'esports-mobile':
                            showEventOption(mobileGamesEvents);
                            showEventOption(teamSection);
                            document.getElementById('mobileGameEvent').required = true;
                            maxTeamSize = 5;
                            document.getElementById('selectionStatus').textContent = '';
                            break;
                            
                        case 'esports-pc':
                            // Highlight that PC games are being shown
                            document.getElementById('selectionStatus').textContent = "🎮 PC Games available! Choose your game: Valorant, CS2, Dota 2, League of Legends, BO6 Multiplayer, Warzone";
                            document.getElementById('selectionStatus').className = 'selection-active';
                            
                            // Force redraw before showing the PC games dropdown
                            pcGamesEvents.style.display = 'none';
                            pcGamesEvents.offsetHeight; // Force reflow
                            
                            // Show PC games with enhanced animation and highlight
                            showEventOption(pcGamesEvents, true); // Pass true for enhanced animation
                            showEventOption(teamSection);
                            document.getElementById('pcGameEvent').required = true;
                            maxTeamSize = 6;
                            
                            // Add special highlighting to the PC games section
                            pcGamesEvents.style.border = '2px solid var(--apple-blue)';
                            pcGamesEvents.style.boxShadow = '0 0 20px rgba(0, 102, 204, 0.3)';
                            
                            // Log that the PC games dropdown is visible
                            console.log("PC Games dropdown should now be visible with games: Valorant, CS2, Dota 2, League of Legends, BO6 Multiplayer, Warzone");
                            break;
                    }
                    
                }, 150); // Slight delay for better visual feedback
            }
        });
        
        // Improved function to hide all event options
        function hideAllEventOptions() {
            [designEvents, hackathonEvents, mobileGamesEvents, pcGamesEvents, teamSection].forEach(el => {
                if (el) {
                    // Remove any special styling
                    el.style.border = '';
                    el.style.boxShadow = '';
                    
                    // Fade out
                    el.style.opacity = '0';
                    el.style.transform = 'translateY(-10px)';
                    
                    // Hide after fade completes
                    setTimeout(() => {
                        el.style.display = 'none';
                    }, 150);
                }
            });
            
            // Reset required attributes
            document.getElementById('designEvent').required = false;
            document.getElementById('hackathonEvent').required = false;
            document.getElementById('mobileGameEvent').required = false;
            document.getElementById('pcGameEvent').required = false;
        }
        
        // Enhanced function to show event options
        function showEventOption(element, isHighPriority = false) {
            if (!element) return;
            
            // Prepare element for animation
            element.style.display = 'block';
            element.style.opacity = '0';
            element.style.transform = 'translateY(-10px)';
            element.style.zIndex = isHighPriority ? '100' : '10'; // Higher z-index for PC games
            
            // Force a reflow to ensure the animation works
            element.offsetHeight;
            
            // More noticeable animation for PC games
            if (isHighPriority) {
                element.classList.add('highlight-event-option');
                
                // Add a pulsing animation to draw attention
                setTimeout(() => {
                    element.style.animation = 'pulse-highlight 2s ease-in-out';
                }, 100);
            }
            
            // Show with animation
            setTimeout(() => {
                element.style.opacity = '1';
                element.style.transform = 'translateY(0)';
                
                // Log that the element is now visible
                console.log(`Element ${element.id} is now visible`);
                
                // For PC games, also log the available options
                if (element.id === 'pcGamesEvents') {
                    const pcGameOptions = element.querySelectorAll('.custom-option');
                    const gameNames = Array.from(pcGameOptions).map(opt => opt.textContent);
                    console.log(`PC Games available: ${gameNames.join(', ')}`);
                }
            }, isHighPriority ? 10 : 50); // Faster display for high priority elements
        }
        
        // Add team member functionality
        addTeamMember.addEventListener('click', function() {
            if (teamSize < maxTeamSize) {
                teamSize++;
                const newMember = document.createElement('div');
                newMember.className = 'input-group';
                newMember.innerHTML = `
                    <i class="fas fa-user"></i>
                    <input type="text" name="teamMember${teamSize}" placeholder="Team Member ${teamSize}" required>
                    <button type="button" class="remove-member" data-member="${teamSize}">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                teamMembers.appendChild(newMember);
                teamSizeDisplay.textContent = teamSize;
                
                // Add remove event listener
                newMember.querySelector('.remove-member').addEventListener('click', function() {
                    teamMembers.removeChild(newMember);
                    teamSize--;
                    teamSizeDisplay.textContent = teamSize;
                });
            } else {
                alert(`Maximum team size for this event is ${maxTeamSize}`);
            }
        });
        
        // Reset team members function
        function resetTeamMembers() {
            teamSize = 1;
            teamSizeDisplay.textContent = teamSize;
            teamMembers.innerHTML = `
                <div class="input-group">
                    <i class="fas fa-user-plus"></i>
                    <input type="text" name="teamMember1" placeholder="Team Captain (You)" disabled>
                </div>
            `;
        }
        
        // Form submission
        registrationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Collect form data
            const formData = new FormData(registrationForm);
            const registrationData = {
                personalInfo: {
                    name: formData.get('name'),
                    email: formData.get('email'),
                    phone: formData.get('phone')
                },
                eventCategory: formData.get('eventCategory'),
                event: getSelectedEvent(formData),
                team: {
                    name: formData.get('teamName') || `${formData.get('name')}'s Team`,
                    members: getTeamMembers(formData)
                },
                timestamp: new Date().toISOString()
            };
            
            // Send data to server
            fetch('/api/register-event', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(registrationData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                registrationMsg.style.color = 'green';
                registrationMsg.textContent = 'Registration successful! Thank you for registering.';
                
                // Also save to localStorage for immediate display in dev console
                saveRegistrationToLocal(registrationData);
                
                // Reset form
                registrationForm.reset();
                resetTeamMembers();
                hideAllEventOptions();
                document.getElementById('selectionStatus').textContent = '';
                
                // Redirect back to home page after 2 seconds
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            })
            .catch(error => {
                console.error('Error:', error);
                registrationMsg.style.color = 'red';
                registrationMsg.textContent = 'There was an error registering. Please try again.';
                
                // Fallback to localStorage if server is unavailable
                saveRegistrationToLocal(registrationData);
                registrationMsg.textContent += ' (Saved locally)';
            });
        });
        
        // Helper function to get selected event
        function getSelectedEvent(formData) {
            const category = formData.get('eventCategory');
            switch(category) {
                case 'design':
                    return formData.get('designEvent');
                case 'hackathon':
                    return formData.get('hackathonEvent');
                case 'esports-mobile':
                    return formData.get('mobileGameEvent');
                case 'esports-pc':
                    return formData.get('pcGameEvent');
                default:
                    return '';
            }
        }
        
        // Helper function to get team members
        function getTeamMembers(formData) {
            const members = [];
            for (let i = 1; i <= teamSize; i++) {
                const member = i === 1 ? formData.get('name') : formData.get(`teamMember${i}`);
                if (member) {
                    members.push(member);
                }
            }
            return members;
        }
        
        // Save registration to localStorage for immediate use in dev console
        function saveRegistrationToLocal(data) {
            const registrations = JSON.parse(localStorage.getItem('eventRegistrations') || '[]');
            registrations.push(data);
            localStorage.setItem('eventRegistrations', JSON.stringify(registrations));
        }

        // Debugging: Add this at the end
        console.log('Custom select initialization complete');
        console.log('Available PC Games: Valorant, CS2, Dota 2, League of Legends, BO6 Multiplayer, Warzone');
    });
    </script>
</body>
</html>